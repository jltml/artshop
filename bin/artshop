#!/usr/bin/env ruby
require "bundler/setup"
require "dry/cli"
require_relative "./../lib/shipper"
require_relative "./../lib/version"

module ArtShop
  module CLI
    module Commands
      extend Dry::CLI::Registry

      class Version < Dry::CLI::Command
        desc "Print version"

        def call(*)
          puts "artshop #{ArtShop::VERSION}"
        end
      end

      class Ship < Dry::CLI::Command
        desc "Run shipments script"

        option :test, type: :boolean, default: false, desc: "Run in test mode"

        def call(**options)
          ArtShop::Scripts.ship(test: options.fetch(:test))
        end
      end

      register "version", Version, aliases: ["v", "-v", "--version"]
      register "ship", Ship
    end
  end
end

Dry::CLI.new(ArtShop::CLI::Commands).call
